<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conference Agenda - Hong Kong</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", Arial, sans-serif; background: #f2f2f7; padding: 20px; max-width: 600px; margin: 0 auto; padding-bottom: 120px; -webkit-tap-highlight-color: transparent; }
        h1 { text-align: center; color: #1d1d1f; font-size: 22px; margin-bottom: 5px; font-weight: 700; }
        .subtitle { text-align: center; color: #86868b; font-size: 14px; margin-bottom: 25px; margin-top: 5px; }
        
        .card { background: white; border-radius: 16px; padding: 16px; margin-bottom: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.04); display: flex; align-items: flex-start; transition: all 0.2s ease; border: 1px solid rgba(0,0,0,0); }
        .card:active { transform: scale(0.98); background: #fcfcfc; }
        .card.selected { border: 1px solid #007AFF; background: #f0f7ff; }

        .checkbox-wrapper { margin-right: 16px; padding-top: 4px; display: flex; align-items: center; }
        .checkbox-wrapper input { width: 22px; height: 22px; accent-color: #007AFF; cursor: pointer; }
        
        .info { flex: 1; }
        .time-tag { color: #007AFF; font-weight: 600; font-size: 13px; display: inline-block; background: rgba(0,122,255,0.1); padding: 2px 8px; border-radius: 6px; margin-bottom: 6px; }
        .info h3 { margin: 0 0 4px 0; font-size: 16px; color: #1d1d1f; line-height: 1.4; font-weight: 600; }
        .speaker { color: #1d1d1f; font-weight: 500; font-size: 14px; margin: 4px 0 2px 0; }
        .affiliation { color: #86868b; font-size: 12px; line-height: 1.3; }

        .btn-container { position: fixed; bottom: 30px; left: 0; right: 0; display: flex; justify-content: center; z-index: 100; pointer-events: none; flex-direction: column; align-items: center;}
        #generateBtn { pointer-events: auto; background-color: #007AFF; color: white; border: none; padding: 16px 30px; border-radius: 40px; font-size: 16px; font-weight: 600; box-shadow: 0 8px 20px rgba(0,122,255,0.3); cursor: pointer; width: 85%; max-width: 350px; transition: transform 0.1s; backdrop-filter: blur(10px); display: flex; align-items: center; justify-content: center; gap: 8px; }
        #generateBtn:active { transform: scale(0.96); }
        .btn-hint { font-size: 12px; color: #999; margin-top: 8px; text-shadow: 0 1px 2px white; background: rgba(255,255,255,0.8); padding: 2px 8px; border-radius: 4px;}
        
        /* ä¼˜åŒ–çš„å¾®ä¿¡é®ç½© */
        #wx-mask { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 9999; color: white; padding: 40px 20px; text-align: center; backdrop-filter: blur(5px); }
        .mask-content { text-align: right; margin-right: 20px; margin-top: 20px;}
        .mask-arrow { font-size: 50px; animation: bounce 1.5s infinite; color: #007AFF; display: inline-block; margin-bottom: 10px;}
        .mask-text { font-size: 20px; font-weight: bold; margin-top: 10px; line-height: 1.5; }
        .mask-sub { font-size: 14px; color: #ccc; margin-top: 15px; font-weight: normal; line-height: 1.5; border-top: 1px solid #333; padding-top: 15px;}
        
        @keyframes bounce { 0%, 100% { transform: translate(0, 0); } 50% { transform: translate(10px, -10px); } }
    </style>
</head>
<body>

    <h1>Conference Agenda Â· Hong Kong</h1>
    <p class="subtitle">2025/12/16 (Tuesday)</p>

    <div id="session-list">
        <!-- JS è‡ªåŠ¨ç”Ÿæˆ -->
    </div>

    <div class="btn-container">
        <button id="generateBtn" onclick="downloadICS()">
            <span style="font-size: 20px">ğŸ“…</span> Add to Calendar
        </button>
        <div class="btn-hint" id="btnHint">Auto-detect timezone: Hong Kong (GMT+8)</div>
    </div>

    <!-- å¾®ä¿¡å¼•å¯¼é®ç½© (åŒè¯­ç‰ˆ) -->
    <div id="wx-mask" onclick="this.style.display='none'">
        <div class="mask-content">
            <div class="mask-arrow">â†—</div>
            <div class="mask-text">
                Please open in Browser<br>
                <span style="font-size: 16px">è¯·ç‚¹å‡»å³ä¸Šè§’ï¼Œé€‰æ‹©â€œåœ¨æµè§ˆå™¨æ‰“å¼€â€</span>
            </div>
            <div class="mask-sub">
                WeChat does not support calendar import directly.<br>
                Please use Safari or Chrome.<br><br>
                å¾®ä¿¡ä¸æ”¯æŒç›´æ¥å¯¼å…¥æ—¥å†æ–‡ä»¶ï¼Œè¯·è·³è½¬æµè§ˆå™¨ä½¿ç”¨ã€‚
            </div>
        </div>
    </div>

<script>
    // ================= é…ç½®åŒºåŸŸ =================
    const CONFERENCE_DATE = '2025/12/16'; 

    const rawData = [
        { time: "09:30 - 10:00", title: "Breakfast", speaker: "", company: "" },
        { time: "10:00 - 10:15", title: "Opening Session", speaker: "Ying Shan", company: "Tencent ARC Lab" },
        { time: "10:15 - 10:45", title: "Towards 3D-aware Video World Models", speaker: "Wenbo Hu", company: "Tencent ARC Lab" },
        { time: "10:45 - 11:15", title: "A Human-Centered Approach to Multimodal Consistent Video Generation: Models and Practical Deployments", speaker: "Tianxiang Zheng", company: "Tencent Hunyuan" },
        { time: "11:15 - 11:45", title: "GameCraft-2: Instruction-Following Interactive Game Video Generation", speaker: "Junshu Tang", company: "Tencent Hunyuan" },
        { time: "14:00 - 14:30", title: "Unleashing AI Creativity with ZenStudio: from AI-content creation product to dedicated model and technology", speaker: "Alan Zhaoã€Ran Zhang", company: "Tencent Video" },
        { time: "14:30 - 15:00", title: "AI Redefining Animation Production â€”â€” End-to-End Innovation in 3D Character Animation", speaker: "Zijiao Zeng", company: "Tencent Games" },
        { time: "15:00 - 15:30", title: "Frontier Exploration and Practices of Rendering Technologies in Gamesâ€”Breaking Aniudiovisual Boundaries, Crafting Next-Generation Interactive Experiences", speaker: "Chao Li", company: "Tencent Games" },
        { time: "15:30 - 16:00", title: "Real-time Turbulent Flows Simulation for Games", speaker: "Kui Wu", company: "Tencent Games" },
        { time: "16:00 - 16:30", title: "Curl-free and Divergence-free Wavelets for Computer Graphics", speaker: "Xiaohua Ren", company: "Weixin/WeChat" },
        { time: "16:30 - 17:00", title: "Panel Session", speaker: "Hostï¼šYuan Liu", company: "Assistant Professor, Hong Kong University of Science and Technology" }
    ];

    // ================= é€»è¾‘å¤„ç† =================

    const sessions = [];
    rawData.forEach((item, index) => {
        const times = item.time.split('-').map(t => t.trim());
        sessions.push({
            id: index,
            title: item.title,
            speaker: item.speaker,
            company: item.company,
            startTimeStr: times[0],
            endTimeStr: times[1],
            displayTime: item.time
        });
    });

    const listContainer = document.getElementById('session-list');
    
    sessions.forEach(session => {
        let speakerHtml = session.speaker ? `<p class="speaker">${session.speaker}</p>` : '';
        let companyHtml = session.company ? `<p class="affiliation">${session.company}</p>` : '';

        const html = `
            <div class="card" id="card-${session.id}" onclick="toggleCheck('${session.id}')">
                <div class="checkbox-wrapper">
                    <input type="checkbox" id="sess-${session.id}" value="${session.id}" onclick="event.stopPropagation(); updateCardStyle('${session.id}')">
                </div>
                <div class="info">
                    <span class="time-tag">${session.displayTime}</span>
                    <h3>${session.title}</h3>
                    ${speakerHtml}
                    ${companyHtml}
                </div>
            </div>
        `;
        listContainer.insertAdjacentHTML('beforeend', html);
    });

    function toggleCheck(id) {
        const checkbox = document.getElementById(`sess-${id}`);
        checkbox.checked = !checkbox.checked;
        updateCardStyle(id);
    }

    function updateCardStyle(id) {
        const checkbox = document.getElementById(`sess-${id}`);
        const card = document.getElementById(`card-${id}`);
        if (checkbox.checked) {
            card.classList.add('selected');
        } else {
            card.classList.remove('selected');
        }
    }

    function downloadICS() {
        const ua = navigator.userAgent.toLowerCase();
        
        // 1. å¾®ä¿¡ç¯å¢ƒæ£€æµ‹
        if (ua.match(/MicroMessenger/i) == "micromessenger") {
            document.getElementById('wx-mask').style.display = 'block';
            return;
        }

        // 2. éªŒè¯é€‰æ‹©
        const checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');
        if (checkboxes.length === 0) {
            alert("Please select at least one session.\nè¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªè®®ç¨‹ã€‚");
            return;
        }

        // 3. å‡†å¤‡ ICS æ•°æ®
        const dateParts = CONFERENCE_DATE.split('/');
        const year = dateParts[0];
        const month = dateParts[1].padStart(2, '0');
        const day = dateParts[2].padStart(2, '0');
        const dateString = `${year}${month}${day}`;

        let icsContent = [
            "BEGIN:VCALENDAR",
            "VERSION:2.0",
            "PRODID:-//TencentConferenceHK//CN",
            "CALSCALE:GREGORIAN",
            "METHOD:PUBLISH",
            "BEGIN:VTIMEZONE",
            "TZID:Asia/Hong_Kong",
            "BEGIN:STANDARD",
            "TZOFFSETFROM:+0800",
            "TZOFFSETTO:+0800",
            "TZNAME:HKT",
            "DTSTART:19700101T000000",
            "END:STANDARD",
            "END:VTIMEZONE"
        ];

        checkboxes.forEach(box => {
            const session = sessions.find(s => s.id == box.value);
            if (session) {
                const startRaw = session.startTimeStr.replace(':', '') + '00';
                const endRaw = session.endTimeStr.replace(':', '') + '00';
                let description = "";
                if (session.speaker) description += `Speaker: ${session.speaker}\\n`;
                if (session.company) description += `Affiliation: ${session.company}`;
                let summary = session.title;
                if (session.speaker && !session.speaker.includes('Host')) {
                     summary = `${session.title} - ${session.speaker.split('ã€')[0]}`; 
                }

                icsContent.push("BEGIN:VEVENT");
                icsContent.push(`UID:hk-conf-${session.id}-${Date.now()}@tencent.com`);
                icsContent.push(`DTSTAMP:${getNowUTC()}`);
                icsContent.push(`DTSTART;TZID=Asia/Hong_Kong:${dateString}T${startRaw}`);
                icsContent.push(`DTEND;TZID=Asia/Hong_Kong:${dateString}T${endRaw}`);
                icsContent.push(`SUMMARY:${summary}`);
                icsContent.push(`DESCRIPTION:${description}`);
                icsContent.push(`LOCATION:Hong Kong`);
                icsContent.push("END:VEVENT");
            }
        });

        icsContent.push("END:VCALENDAR");

        // 4. ç”Ÿæˆå¹¶ä¸‹è½½
        const fileContent = icsContent.join("\r\n");
        const blob = new Blob([fileContent], { type: 'text/calendar;charset=utf-8' });
        const url = URL.createObjectURL(blob);
        
        const link = document.createElement('a');
        link.href = url;
        link.setAttribute('download', 'HK_Conference.ics');
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);

        // 5. é’ˆå¯¹å®‰å“çš„é¢å¤–æç¤º (å› ä¸ºå®‰å“ä¸ä¼šè‡ªåŠ¨å¼¹å‡ºå¯¼å…¥ç•Œé¢)
        if (ua.indexOf('android') > -1) {
            setTimeout(() => {
                alert("ğŸ“… Download Started!\n\nPlease check your Notification Bar, tap the downloaded file 'HK_Conference.ics' to import.\n\nä¸‹è½½å·²å¼€å§‹ï¼\nè¯·ä¸‹æ‹‰é€šçŸ¥æ ï¼Œç‚¹å‡»ä¸‹è½½çš„æ–‡ä»¶ä»¥å¯¼å…¥æ—¥å†ã€‚");
            }, 800);
        }
    }

    function getNowUTC() {
        const now = new Date();
        return now.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
    }
</script>

</body>
</html>

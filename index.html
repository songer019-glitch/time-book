<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¼šè®®æ—¥ç¨‹åŠ©æ‰‹ - é¦™æ¸¯ç«™</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", Arial, sans-serif; background: #f2f2f7; padding: 20px; max-width: 600px; margin: 0 auto; padding-bottom: 120px; -webkit-tap-highlight-color: transparent; }
        h1 { text-align: center; color: #1d1d1f; font-size: 22px; margin-bottom: 10px; font-weight: 700; letter-spacing: -0.5px; }
        .subtitle { text-align: center; color: #86868b; font-size: 14px; margin-bottom: 25px; }
        
        .card { background: white; border-radius: 16px; padding: 16px; margin-bottom: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.04); display: flex; align-items: flex-start; transition: all 0.2s ease; border: 1px solid rgba(0,0,0,0); }
        .card:active { transform: scale(0.98); background: #fcfcfc; }
        
        /* é€‰ä¸­æ€æ ·å¼ */
        .card.selected { border: 1px solid #007AFF; background: #f0f7ff; }

        .checkbox-wrapper { margin-right: 16px; padding-top: 4px; display: flex; align-items: center; }
        .checkbox-wrapper input { width: 22px; height: 22px; accent-color: #007AFF; cursor: pointer; }
        
        .info { flex: 1; }
        .time-tag { color: #007AFF; font-weight: 600; font-size: 13px; display: inline-block; background: rgba(0,122,255,0.1); padding: 2px 8px; border-radius: 6px; margin-bottom: 6px; }
        .info h3 { margin: 0 0 4px 0; font-size: 16px; color: #1d1d1f; line-height: 1.4; font-weight: 600; }
        .speaker { color: #1d1d1f; font-weight: 500; font-size: 14px; margin: 4px 0 2px 0; }
        .affiliation { color: #86868b; font-size: 12px; line-height: 1.3; }

        .btn-container { position: fixed; bottom: 30px; left: 0; right: 0; display: flex; justify-content: center; z-index: 100; pointer-events: none; }
        #generateBtn { pointer-events: auto; background-color: #007AFF; color: white; border: none; padding: 16px 30px; border-radius: 40px; font-size: 16px; font-weight: 600; box-shadow: 0 8px 20px rgba(0,122,255,0.3); cursor: pointer; width: 85%; max-width: 350px; transition: transform 0.1s; backdrop-filter: blur(10px); display: flex; align-items: center; justify-content: center; gap: 8px; }
        #generateBtn:active { transform: scale(0.96); }
        
        /* å¾®ä¿¡é®ç½© */
        #wx-mask { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 9999; color: white; text-align: right; padding-top: 50px; padding-right: 30px; backdrop-filter: blur(4px); }
        .arrow-icon { font-size: 40px; animation: bounce 1.5s infinite; display: inline-block; margin-bottom: 10px;}
        @keyframes bounce { 0%, 100% { transform: translate(0, 0); } 50% { transform: translate(10px, -10px); } }
    </style>
</head>
<body>

    <h1>ä¼šè®®æ—¥ç¨‹ Â· é¦™æ¸¯ç«™</h1>
    <p class="subtitle">2025å¹´12æœˆ16æ—¥ (Tuesday)</p>

    <div id="session-list">
        <!-- JS è‡ªåŠ¨ç”Ÿæˆ -->
    </div>

    <div class="btn-container">
        <button id="generateBtn" onclick="downloadICS()">
            <span style="font-size: 20px">ğŸ“…</span> æ·»åŠ åˆ°æ—¥å†
        </button>
    </div>

    <!-- å¾®ä¿¡å¼•å¯¼é®ç½© -->
    <div id="wx-mask" onclick="this.style.display='none'">
        <div class="arrow-icon">â†—</div>
        <div style="font-size: 18px; font-weight: bold; line-height: 1.6;">
            <p>ç‚¹å‡»å³ä¸Šè§’èœå• Â·Â·Â·</p>
            <p>é€‰æ‹© <span style="color: #4db8ff; border-bottom: 2px solid #4db8ff;">åœ¨æµè§ˆå™¨æ‰“å¼€</span></p>
        </div>
        <p style="font-size: 13px; color: #ccc; margin-top: 40px; text-align: center; width: 100%;">
            å¾®ä¿¡å†…æ ¸æ— æ³•ç›´æ¥å¯¼å…¥æ—¥å†æ–‡ä»¶<br>è¯·è·³è½¬è‡³ Safari æˆ– Chrome
        </p>
    </div>

<script>
    // ================= é…ç½®åŒºåŸŸ =================
    
    // ğŸ‘‡ ä¼šè®®æ—¥æœŸè®¾ç½® (æ ¼å¼: YYYY/MM/DD)
    // æ ¹æ®æ‚¨çš„è¦æ±‚ï¼Œè®¾ç½®ä¸º12æœˆ16æ—¥ã€‚å¹´ä»½æš‚å®š2025ï¼Œå¦‚æ˜¯2024è¯·è‡ªè¡Œä¿®æ”¹
    const CONFERENCE_DATE = '2025/12/16'; 

    // åŸå§‹è®®ç¨‹æ•°æ® (ä¿æŒä¸å˜)
    const rawData = [
        { time: "09:30 - 10:00", title: "Breakfast", speaker: "", company: "" },
        { time: "10:00 - 10:15", title: "Opening Session", speaker: "Ying Shan", company: "Tencent ARC Lab" },
        { time: "10:15 - 10:45", title: "Towards 3D-aware Video World Models", speaker: "Wenbo Hu", company: "Tencent ARC Lab" },
        { time: "10:45 - 11:15", title: "A Human-Centered Approach to Multimodal Consistent Video Generation: Models and Practical Deployments", speaker: "Tianxiang Zheng", company: "Tencent Hunyuan" },
        { time: "11:15 - 11:45", title: "GameCraft-2: Instruction-Following Interactive Game Video Generation", speaker: "Junshu Tang", company: "Tencent Hunyuan" },
        { time: "14:00 - 14:30", title: "Unleashing AI Creativity with ZenStudio: from AI-content creation product to dedicated model and technology", speaker: "Alan Zhaoã€Ran Zhang", company: "Tencent Video" },
        { time: "14:30 - 15:00", title: "AI Redefining Animation Production â€”â€” End-to-End Innovation in 3D Character Animation", speaker: "Zijiao Zeng", company: "Tencent Games" },
        { time: "15:00 - 15:30", title: "Frontier Exploration and Practices of Rendering Technologies in Gamesâ€”Breaking Aniudiovisual Boundaries, Crafting Next-Generation Interactive Experiences", speaker: "Chao Li", company: "Tencent Games" },
        { time: "15:30 - 16:00", title: "Real-time Turbulent Flows Simulation for Games", speaker: "Kui Wu", company: "Tencent Games" },
        { time: "16:00 - 16:30", title: "Curl-free and Divergence-free Wavelets for Computer Graphics", speaker: "Xiaohua Ren", company: "Weixin/WeChat" },
        { time: "16:30 - 17:00", title: "Panel Session", speaker: "Hostï¼šYuan Liu", company: "Assistant Professor, Hong Kong University of Science and Technology" }
    ];

    // ================= é€»è¾‘å¤„ç†åŒºåŸŸ =================

    const sessions = [];
    
    // è§£ææ•°æ®
    rawData.forEach((item, index) => {
        const times = item.time.split('-').map(t => t.trim());
        // ä¸ºäº†ç¡®ä¿è·¨æ—¶åŒºæ­£å¸¸å·¥ä½œï¼Œè¿™é‡Œæˆ‘ä»¬åªè§£æå°æ—¶å’Œåˆ†é’Ÿå­—ç¬¦ä¸²
        // ä¸ç”Ÿæˆ Date å¯¹è±¡è¿›è¡Œè®¡ç®—ï¼Œè€Œæ˜¯ç›´æ¥æ“ä½œæ—¶é—´å­—ç¬¦ä¸²
        sessions.push({
            id: index,
            title: item.title,
            speaker: item.speaker,
            company: item.company,
            startTimeStr: times[0], // "09:30"
            endTimeStr: times[1],   // "10:00"
            displayTime: item.time
        });
    });

    const listContainer = document.getElementById('session-list');
    
    // æ¸²æŸ“åˆ—è¡¨
    sessions.forEach(session => {
        let speakerHtml = session.speaker ? `<p class="speaker">${session.speaker}</p>` : '';
        let companyHtml = session.company ? `<p class="affiliation">${session.company}</p>` : '';

        const html = `
            <div class="card" id="card-${session.id}" onclick="toggleCheck('${session.id}')">
                <div class="checkbox-wrapper">
                    <input type="checkbox" id="sess-${session.id}" value="${session.id}" onclick="event.stopPropagation(); updateCardStyle('${session.id}')">
                </div>
                <div class="info">
                    <span class="time-tag">${session.displayTime}</span>
                    <h3>${session.title}</h3>
                    ${speakerHtml}
                    ${companyHtml}
                </div>
            </div>
        `;
        listContainer.insertAdjacentHTML('beforeend', html);
    });

    function toggleCheck(id) {
        const checkbox = document.getElementById(`sess-${id}`);
        checkbox.checked = !checkbox.checked;
        updateCardStyle(id);
    }

    function updateCardStyle(id) {
        const checkbox = document.getElementById(`sess-${id}`);
        const card = document.getElementById(`card-${id}`);
        if (checkbox.checked) {
            card.classList.add('selected');
        } else {
            card.classList.remove('selected');
        }
    }

    // ç”Ÿæˆ ICS æ ¸å¿ƒé€»è¾‘
    function downloadICS() {
        // å¾®ä¿¡æ£€æµ‹
        const ua = navigator.userAgent.toLowerCase();
        if (ua.match(/MicroMessenger/i) == "micromessenger") {
            document.getElementById('wx-mask').style.display = 'block';
            return;
        }

        const checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');
        if (checkboxes.length === 0) {
            alert("è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªè®®ç¨‹");
            return;
        }

        // è§£ææ—¥æœŸå­—ç¬¦ä¸²ä¸º YYYYMMDD æ ¼å¼
        const dateParts = CONFERENCE_DATE.split('/');
        // è¡¥å…¨æœˆä»½å’Œæ—¥æœŸä¸ºä¸¤ä½æ•°
        const year = dateParts[0];
        const month = dateParts[1].padStart(2, '0');
        const day = dateParts[2].padStart(2, '0');
        const dateString = `${year}${month}${day}`; // e.g., 20251216

        let icsContent = [
            "BEGIN:VCALENDAR",
            "VERSION:2.0",
            "PRODID:-//TencentConferenceHK//CN",
            "CALSCALE:GREGORIAN",
            "METHOD:PUBLISH",
            // å®šä¹‰é¦™æ¸¯æ—¶åŒºï¼Œå…¼å®¹æ€§æ›´å¥½
            "BEGIN:VTIMEZONE",
            "TZID:Asia/Hong_Kong",
            "BEGIN:STANDARD",
            "TZOFFSETFROM:+0800",
            "TZOFFSETTO:+0800",
            "TZNAME:HKT",
            "DTSTART:19700101T000000",
            "END:STANDARD",
            "END:VTIMEZONE"
        ];

        checkboxes.forEach(box => {
            const session = sessions.find(s => s.id == box.value);
            if (session) {
                // æ„é€ æ—¶é—´æ ¼å¼: YYYYMMDDTHHmm00
                // å»æ‰æ—¶é—´ä¸­çš„å†’å· "09:30" -> "0930"
                const startRaw = session.startTimeStr.replace(':', '') + '00';
                const endRaw = session.endTimeStr.replace(':', '') + '00';

                let description = "";
                if (session.speaker) description += `æ¼”è®²äºº: ${session.speaker}\\n`;
                if (session.company) description += `å•ä½: ${session.company}`;

                // æ ‡é¢˜ä¼˜åŒ–
                let summary = session.title;
                if (session.speaker && !session.speaker.includes('Host')) {
                     summary = `${session.title} - ${session.speaker.split('ã€')[0]}`; 
                }

                icsContent.push("BEGIN:VEVENT");
                icsContent.push(`UID:hk-conf-${session.id}-${Date.now()}@tencent.com`);
                icsContent.push(`DTSTAMP:${getNowUTC()}`);
                
                // å…³é”®ï¼šå¼ºåˆ¶æŒ‡å®šé¦™æ¸¯æ—¶åŒº (TZID=Asia/Hong_Kong)
                // è¿™æ ·æ— è®ºç”¨æˆ·æ‰‹æœºæ˜¯ä»€ä¹ˆæ—¶åŒºï¼Œæ—¥å†éƒ½ä¼šæ˜¾ç¤ºä¸ºé¦™æ¸¯æ—¶é—´çš„ 09:30
                icsContent.push(`DTSTART;TZID=Asia/Hong_Kong:${dateString}T${startRaw}`);
                icsContent.push(`DTEND;TZID=Asia/Hong_Kong:${dateString}T${endRaw}`);
                
                icsContent.push(`SUMMARY:${summary}`);
                icsContent.push(`DESCRIPTION:${description}`);
                icsContent.push(`LOCATION:Hong Kong`); // å¯ä»¥ä¿®æ”¹ä¸ºå…·ä½“é…’åº—/ä¼šåœº
                icsContent.push("END:VEVENT");
            }
        });

        icsContent.push("END:VCALENDAR");

        const fileContent = icsContent.join("\r\n");
        const blob = new Blob([fileContent], { type: 'text/calendar;charset=utf-8' });
        const url = URL.createObjectURL(blob);
        
        const link = document.createElement('a');
        link.href = url;
        link.setAttribute('download', 'HK_Conference_Schedule.ics');
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

    // è·å–å½“å‰ UTC æ—¶é—´ç”¨äº DTSTAMP
    function getNowUTC() {
        const now = new Date();
        return now.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
    }
</script>

</body>
</html>